var username="",psw="",repsw="",truename="",sex="",email="",birthday="",oldpsw="";
var flag=true;

$("#username").blur(function(){
	username = $("#username").val();
	if(""==$.trim(username)) {
		flag=false;
		$("#usernametip").html("用户名不能为空");
	}else if(username.indexOf(" ")!=-1) {
		flag=false;
		$("#usernametip").html("用户名不能含空格");
	}
}).focus(function(){
	flag=true;
	$("#usernametip").html("");
});

$("#psw").blur(function(){
	psw = $("#psw").val();
	if(""==$.trim(psw)) {
		flag=false;
		$("#pswtip").html("密码不能为空");
	}else if(psw.indexOf(" ")!=-1){
		flag=false;
		$("#pswtip").html("密码不能含空格");
	}
}).focus(function(){
	flag=true;
	$("#pswtip").html("");
});

$("#repsw").blur(function(){
	repsw = $("#repsw").val();
	if(""==$.trim(repsw)) {
		flag=false;
		$("#repswtip").html("重复密码不能为空");
	}else if(repsw != psw) {
		flag=false;
		$("#repswtip").html("重复密码输入不一致");
	}
}).focus(function(){
	flag=true;
	$("#repswtip").html("");
});

$("#email").blur(function(){
	email=$("#email").val();
	var reg = /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;
	if(""==$.trim(email)){
		flag=false;
		$("#emailtip").html("邮箱不能为空");
	}else if(!reg.test(email)) {
		flag=false;
		$("#emailtip").html("邮箱格式不正确");
	}
}).focus(function(){
	flag=true;
	$("#emailtip").html("");
});

$("#oldpsw").blur(function(){
	oldpsw = $("#oldpsw").val();
	if(""==$.trim(oldpsw)){
		flag=false;
		$("#oldpswtip").html("老密码不能为空");
	}
}).focus(function(){
	flag=true;
	$("#oldpswtip").html("");
});

//按钮函数
function register() {
	
	if(flag==true) {
		/*
		 * 重判
		 */
		username = $("#username").val();
		if(""==$.trim(username)) {
			flag=false;
			$("#usernametip").html("用户名不能为空");
			return;
		}else if(username.indexOf(" ")!=-1) {
			flag=false;
			$("#usernametip").html("用户名不能含空格");
			return;
		}
		psw = $("#psw").val();
		if(""==$.trim(psw)) {
			flag=false;
			$("#pswtip").html("密码不能为空");
			return;
		}else if(psw.indexOf(" ")!=-1){
			flag=false;
			$("#pswtip").html("密码不能含空格");
			return;
		}
		repsw = $("#repsw").val();
		if(""==$.trim(repsw)) {
			flag=false;
			$("#repswtip").html("重复密码不能为空");
			return;
		}else if(repsw != psw) {
			flag=false;
			$("#repswtip").html("重复密码输入不一致");
			return;
		}
		email=$("#email").val();
		var reg = /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;
		if(""==$.trim(email)){
			flag=false;
			$("#emailtip").html("邮箱不能为空");return;
		}else if(!reg.test(email)) {
			flag=false;
			$("#emailtip").html("邮箱格式不正确");return;
		}
		
		truename=$("#truename").val();
		sex = $("input[name='sex']:checked").val();
		birthday = $(".rendezvous-input-date:eq(0)").val();
		/*
		 * Ajax模块
		 */
		var url="../Jsecond/MyJBlog_register";
		var Myjson = {
				"username": username,
				"psw": psw,
				"repsw" : repsw,
				"truename": truename,
				"email" : email,
				"sex" : sex,
				"birthday" : birthday,
				timestamp : new Date().getTime()
		};
		$.post(url, Myjson, function(data) {
			var result = data.result;
			
			/*alert(data.map.user.username);
			alert(data.map.user.userId);*/
			
			if(result == false) {
				$("#usernametip").html("用户名已存在");
				flag=false;return;
			}else {
				alert("注册成功");
				window.location.href="../login";
			}
			
		});
	}
}